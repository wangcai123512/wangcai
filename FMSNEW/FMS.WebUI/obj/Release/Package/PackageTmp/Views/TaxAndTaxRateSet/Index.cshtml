@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout_New.cshtml";
}
<script type="text/javascript">
    $(document).ready(function () {
        $('#example3').multiselect({
            buttonWidth: '100%',
            enableFiltering: true,
            includeFilterNewBtn: false,
            enableFiltering: false
        });
    });
</script>
<br />
<br />
<br />
<div id="main" style="margin-top: 50px;background-color: #FFF;padding-bottom: 80px">
    <!-- Start: Sidebar -->
    <aside id="sidebar_left" style="font-size: 16px;">
        <div class="sidebar-menu" style="margin-top:1px;padding-bottom: 80px">
            <ul class="nav">
                <li><span class="sidebar-title" style="font-size: 14px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我的公司：<a onclick="javascript:window.location = '/CompanyInformationSet/Index'" href="javascript:window.location = '/CompanyInformationSet/Index'"><span class="sidebar-title" style="font-size: 14px; color: #023A85"><b>@Session["CompanyName"]</b></span></a></span></li>
                <li><span class="sidebar-title" style="font-size: 14px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;财务统计货币：<a onclick="javascript:window.location = '/Company/ChangeCompanySetting'" href="javascript:window.location = '/Company/ChangeCompanySetting'"><span class="sidebar-title" style="font-size: 14px; color: #023A85"><b>@Session["Currency"]</b></span></a></span></li>
                <li id="UserInfo"> <a onclick="javascript: window.location = '/UserInfo/Index'" href="javascript:window.location = '/UserInfo/Index'"><span class="glyphicons glyphicons-chevron-right" style="font-size: 14px"></span><span class="sidebar-title" style="font-size: 14px">我的属性</span></a></li>
                <li> <a onclick="javascript:window.location = '/Company/ChooseAndAddCompany'" href="javascript:window.location = '/Company/ChooseAndAddCompany'"><span class="glyphicons glyphicons-chevron-right" style="font-size: 14px"></span><span class="sidebar-title" style="font-size: 14px">新增或切换公司</span></a></li>
                <li class="active">
                    <a class="accordion-toggle menu-open" href="#sideFour"><span class="glyphicons glyphicons-chevron-right" style="font-size: 14px"></span><span class="sidebar-title" style="font-size: 14px">财务数据设置</span></a>
                    <ul id="sideFour" class="nav sub-nav">
                        <li><a onclick="javascript:window.location = '/InitialBalanceManagement/Index'" href="#"><span class="sidebar-title" style="font-size: 14px">科目余额初始化</span></a></li>
                        <li class="active"><a onclick="javascript:window.location = '/TaxAndTaxRateSet/Index'" href="#"><span class="sidebar-title" style="font-size: 14px;color: #08C">税种与税率设置</span></a></li>
                        <li><a onclick="javascript:window.location = '/CurrencyAndExchangeRateManagement/Index'" href="#"><span class="sidebar-title" style="font-size: 14px">货币与汇率设置</span></a></li>
                        @*<li><a onclick="javascript:window.location = '/DetailManagement/Index'" href="#"><span class="sidebar-title" style="font-size: 14px">费用类别设置</span></a></li>*@
                         <li><a onclick="javascript:window.location = '/BusinessUnitSetting/Index'" href="#"><span class="sidebar-title" style="font-size: 14px">业务单元设置</span></a></li>
                    </ul>
                </li>
                <li> <a onclick="javascript:window.location = '/GeneralLedgerAccount/GeneralLedger'" href="javascript:window.location = '/GeneralLedgerAccount/GeneralLedger'"><span class="glyphicons glyphicons-chevron-right" style="font-size: 14px"></span><span class="sidebar-title" style="font-size: 14px">设置会计科目</span></a></li>
                <li>
                    <a class="accordion-toggle" href="#sidecompany"><span class="glyphicons glyphicons-chevron-right" style="font-size: 14px"></span><span class="sidebar-title" style="font-size: 14px">公司登记</span></a>
                    <ul id="sidecompany" class="nav sub-nav">
                        <li> <a onclick="javascript: window.location = '/BusinessPartnerSetting/BusinessPartner'" href="javascript:window.location = '/BusinessPartnerSetting/BusinessPartner'"><span class="sidebar-title" style="font-size: 14px">往来公司登记</span></a></li>
                        <li> <a onclick="javascript: window.location = '/BusinessPartnerSetting/Index'" href="javascript:window.location = '/BusinessPartnerSetting/Index'"><span class="sidebar-title" style="font-size: 14px">往来公司查询</span></a></li>
                    </ul>
                </li>
                <li>
                    <a class="accordion-toggle" href="#sideVoucher"><span class="glyphicons glyphicons-chevron-right" style="font-size: 14px"></span><span class="sidebar-title" style="font-size: 14px">科目查询</span></a>
                    <ul id="sideVoucher" class="nav sub-nav">
                        <li><a onclick="javascript: window.location = '/InitialBalanceManagement/Search'" href="javascript:window.location = '/InitialBalanceManagement/Search'"><span class="sidebar-title" style="font-size: 14px">科目流水查询</span></a></li>
                        <li><a onclick="javascript: window.location = '/InitialBalanceManagement/BalanceSearch'" href="javascript:window.location = '/InitialBalanceManagement/BalanceSearch'"><span class="sidebar-title" style="font-size: 14px">科目余额查询</span></a></li>
                        @*<li><a href="#"><span class="sidebar-title" style="font-size: 14px">科目余额</span></a></li>*@
                    </ul>
                </li>
                
                <li> <a class="accordion-toggle" href="#sideTwo"><span class="glyphicons glyphicons-chevron-right" style="font-size: 14px"></span><span class="sidebar-title" style="font-size: 14px">用户管理</span></a>
                        <ul id="sideTwo" class="nav sub-nav">
                            <li><a onclick="javascript:window.location = '/UserManagement/AddUser'" href="#"><span class="sidebar-title" style="font-size: 14px">增加新用户</span></a></li>
                            <li><a onclick="javascript:window.location = '/UserManagement/UserList'" href="#"><span class="sidebar-title" style="font-size: 14px">变更用户权限</span></a></li>
                            <li><a onclick="javascript:window.location = '/UserManagement/ExchangeManager'" href="#"><span class="sidebar-title" style="font-size: 14px">变更管理者</span></a></li>
                            <li><a onclick="javascript:window.location = '/Company/EditUser'" href="#"><span class="sidebar-title" style="font-size: 14px">修改密码</span></a></li>
                        </ul>
                    </li>
                    
                @*<li>
                    <a class="accordion-toggle" href="#sideVoucher"><span class="glyphicons glyphicons-chevron-right" style="font-size: 14px"></span><span class="sidebar-title" style="font-size: 14px">会计凭证</span></a>
                    <ul id="sideVoucher" class="nav sub-nav">
                        <li> <a onclick="javascript:window.location = '/VoucherQuery/VoucherRecord'" href="javascript:window.location = '/VoucherQuery/VoucherRecord'"><span class="glyphicons glyphicons-chevron-right" style="font-size: 14px"></span><span class="sidebar-title" style="font-size: 14px">新增会计凭证</span></a></li>
                        <li> <a onclick="javascript:window.location = '/VoucherQuery/Index'" href="javascript:window.location = '/VoucherQuery/Index'"><span class="glyphicons glyphicons-chevron-right" style="font-size: 14px"></span><span class="sidebar-title" style="font-size: 14px">查询会计凭证</span></a></li>
                    </ul>
                </li>*@
                <li> <a onclick="javascript:window.location = '/IncomeRecord/Temporary'" href="javascript:window.location = '/IncomeRecord/Temporary'"><span class="glyphicons glyphicons-chevron-right" style="font-size: 14px"></span><span class="sidebar-title" style="font-size: 14px">寻求会计帮助</span></a></li>
            </ul>
        </div>
    </aside>
    <!-- Start: Content -->
    <section id="content_wrapper" style="margin-top: -20px;background-color: #FFF;padding-bottom: 20px">
        <div id="MAIN" style="background-color: #FFF">
            <div id="content">
               <div class="row">
               <div class="col-md-12">
              @* <div class="panel pannel-visible">
              <div class="panel-heading">
                <span class="panel-title"><span class="glyphicon glyphicon-pencil"></span>税种与汇率设置</span>
              </div>*@
                

                        @*<div class="panel-body pbn">*@
                        </br>
                        </br>
                            <div class="col-md-4">
                                <form class="cmxform" id="altForm" method="get">
                                    <div class="form-group">
                                        <div class="input-group" style="margin: 0">
                                            <span class="input-group-addon">新建税种</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="input-group" style="margin: 0">
                                            <span class="input-group-addon">税种名称</span>
                                            <input type="text" class="form-control" placeholder="" name="Name" id="Name">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="input-group" style="margin: 0">
                                            <span class="input-group-addon">&nbsp;&nbsp;&nbsp;税&nbsp;率&nbsp;&nbsp;&nbsp;</span>
                                            <input type="text" class="form-control" placeholder="" name="Rate" id="Rate">
                                            <span class="input-group-addon">%</span>
                                        </div>
                                    </div>
                                    <div class="form-group" id="NewTaxInfo">
                                        <div class="input-group" style="margin: 0">
                                            <span class="input-group-addon" style="border-right: 1px solid #808080">&nbsp;&nbsp;&nbsp;属&nbsp;性&nbsp;&nbsp;&nbsp;</span>
                                            <span class="input-group-addon  form-control" style="border-right: 1px solid #808080; background-color:#FFF;width:200px">
                                                <label class="radio-inline" style="margin-left:-10px">
                                                    <input type="radio" name="Type" id="inlineRadio1" value="一般纳税人">一般纳税人
                                                </label>
                                                <label class="radio-inline" style="margin-left:-5px">
                                                    <input type="radio" name="Type" checked="true" id="inlineRadio2" value="小规模纳税人"> 小规模纳税人
                                                </label>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group ">
                                        <label>
                                        </label>
                                        <a class='btn btn-sm bg-purple2 pull-right' href='#' onclick="addtr()">添 加 >></a>
                                    </div>
                                </form>
                            </div>
                            <div class="col-md-8">
                                <div class="form-group">
                                    <div class="input-group" style="margin: 0">
                                        <span class="input-group-addon">查看税种与税率信息</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <table id="TaxTable" class="table table-striped  table-hover"></table>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="margin: auto; text-align: center">
                            <button onclick="submit()" type="button" style="margin-top: 20px; height: 40px; width: 20%;
                            border-radius: 100px; font-size: 20px; border: 0px solid #c0c0c0; font-weight: bold"
                                    class="btn btn-primary">
                                提交
                            </button>
                            <button onclick="window.history.go(-1)" type="button" style="margin-top: 20px;
                            height: 40px; width: 20%; border-radius: 100px; font-size: 20px; border: 0px solid #c0c0c0;
                            font-weight: bold" class="btn btn-primary">
                                返回上页
                            </button>
                       
                   
     
            </div>
             </div>
               </div>
               </div> 
    </section>
</div>

<script type="text/javascript">
    jQuery(document).ready(function () {

        $('#TaxTable').bootstrapTable({
            url: "/TaxAndTaxRateSet/GetTaxAndTaxRateList",
            method: 'get',
            pageSize: 10,
            pageList: [10, 25, 50, 100, 200], // 自定义分页列表
            pageNumber: 1,
            singleSelect: true,
            clickToSelect: true,
            checkOnSelect: true,
            selectOnCheck: true,
            pagination: true,
            queryParams: "10",
            uniqueId: "T_GUID",
            //sortName: 'Name', // 设置默认排序为 name
            //sortOrder: 'desc', // 设置排序为反序 desc
            //search: true, // 开启搜索功能
            columns: [[
                { field: 'Name', title: '税种名称', editable: { type: 'text', title: '税种名称' } },
                { field: 'Rate', title: '税 率 ( % )', editable: { type: 'text', title: '税 率' } },
                { field: 'Type', title: '属 性', editable: { type: 'text', title: '属 性' } },
                { field: "T_GUID", formatter: LinkHandle }
            ]],
            
            //            columns: [[
            //                    { field: 'Name', title: '税种名称' },
            //                    { field: 'Rate', title: '税 率 ' },
            //                    { field: 'Type', title: '属 性' },
            //                    //{ field: "T_GUID", formatter: LinkHandle }
            //                    ]],
        });
        //$('#example-single').multiselect();
        //$('#example-single1').multiselect();

    });

    LinkHandle = function (value, row, ind) {
        var link2 = " <button class='btn btn-primary btn-sm  ''  onclick='Delt(\"" + value + "\")'><span class='glyphicons glyphicons-bin'></span></button> ";
        return link2;
    }
    //添加新记录
    function addtr() {
        var newGuid = NewGUID();
        var type = $('input[name="Type"]:checked ').val();
        var name = $('#Name').val();
        var rate = $('#Rate').val();
        var currentCompanyGuid = '@Session["CurrentCompanyGuid"]';
        var table = $("#TaxTable");
        table.bootstrapTable('insertRow', { index: 0, row: { "T_GUID": newGuid, "Name": name, "Rate": rate, "Type": type, "C_GUID": currentCompanyGuid } });
        
    }
    //提交表信息
    function submit() {
        var allTableData = $("#TaxTable").bootstrapTable('getData');//获取表格的所有内容行  
        var jsonData = JSON.stringify(allTableData);
        $.ajax({
            type: 'Post',
            url: '/TaxAndTaxRateSet/UpdTaxAndTaxRate/',
            data: { jsonData: jsonData },
            async: false,
            success: function (data) {
                alert(data);
                $('#TaxTable').bootstrapTable('refresh');
            }
        });
    }
    
    function Insert() {
        $.ajax({
            type: 'Post',
            url: '/TaxAndTaxRateSet/UpdTaxAndTaxRate/',
            data: $('#altForm').serialize(),
            async: false,
            success: function (data) {
                alert(data)
            }
        });
        $('#TaxTable').bootstrapTable('refresh');
    }

    function Edit(value) {
        var currow = $('#TaxTable').bootstrapTable('getRowByUniqueId', value);
        $.ajax({
            type: 'Post',
            url: '/TaxAndTaxRateSet/UpdTaxAndTaxRate/',
            data: currow,
            async: false,
            success: function (data) {
                alert(data);
            }
        });
        $('#TaxTable').bootstrapTable('refresh');
    }

    function Delt(id) {
        if (confirm('确认删除？')) {
            $('#TaxTable').bootstrapTable('removeByUniqueId', id);
        }
    }
</script>
